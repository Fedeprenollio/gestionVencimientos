  {tabIndex === 1 && (
        <Box>
          <EspecialesInput
            productos={especiales}
            setProductos={setEspeciales}
          />

          <Divider sx={{ my: 2 }} />

          {/* RESUMEN + BOTONES */}
          <Box
            sx={{
              display: "flex",
              gap: 2,
              flexWrap: "wrap",
              alignItems: "center",
              justifyContent: "space-between",
              mb: 2,
            }}
          >
            <Box sx={{ display: "flex", gap: 1, flexWrap: "wrap" }}>
              <Chip
                label={`Con stock: ${especialesConStock.length}`}
                color="success"
                variant="outlined"
              />
              <Chip
                label={`Sin stock: ${especialesSinStock.length}`}
                color="warning"
                variant="outlined"
              />
              <Chip
                label={`Total: ${especiales.length}`}
                color="primary"
                variant="outlined"
              />
            </Box>

            <Box sx={{ display: "flex", gap: 1, flexWrap: "wrap" }}>
              <Button
                variant="contained"
                color="primary"
                disabled={selectedEspeciales.size === 0}
                onClick={() => {
                  const selected = especiales.filter((p) =>
                    selectedEspeciales.has(p._id),
                  );

                  generatePDF_Grandes({ especiales: selected, scale });
                }}
              >
                Imprimir seleccionados ({selectedEspeciales.size})
              </Button>

              <Button variant="outlined" onClick={selectAllEspeciales}>
                Seleccionar todos
              </Button>

              <Button
                variant="outlined"
                color="error"
                onClick={clearSelectedEspeciales}
              >
                Limpiar selecci√≥n
              </Button>

              {especialesConStock.length > 0 && (
                <Button
                  variant="contained"
                  color="success"
                  onClick={() =>
                    generatePDF_Grandes({
                      especiales: especialesConStock,
                      scale,
                    })
                  }
                >
                  Generar PDF (con stock)
                </Button>
              )}

              {especialesSinStock.length > 0 && (
                <Button
                  variant="contained"
                  color="warning"
                  onClick={() =>
                    generatePDF_Grandes({
                      especiales: especialesSinStock,
                      scale,
                    })
                  }
                >
                  Generar PDF (sin stock)
                </Button>
              )}
            </Box>
          </Box>

          {/* TABLA COMPLETA */}
          {especiales.length === 0 ? (
            <Typography variant="body2" sx={{ opacity: 0.7 }}>
              No hay productos cargados todav√≠a.
            </Typography>
          ) : (
            <Box
              sx={{
                border: "1px solid #ddd",
                borderRadius: 2,
                overflow: "hidden",
              }}
            >
              <Table size="small">
                <TableHead>
                  <TableRow sx={{ backgroundColor: "#fafafa" }}>
                    <TableCell sx={{ fontWeight: "bold" }} align="center">
                      ‚úî
                    </TableCell>

                    <TableCell sx={{ fontWeight: "bold" }}>Producto</TableCell>
                    <TableCell sx={{ fontWeight: "bold" }} align="right">
                      Precio
                    </TableCell>
                    <TableCell sx={{ fontWeight: "bold" }} align="right">
                      Precio ant.
                    </TableCell>
                    <TableCell sx={{ fontWeight: "bold" }} align="right">
                      Desc. %
                    </TableCell>
                    <TableCell sx={{ fontWeight: "bold" }} align="right">
                      Final
                    </TableCell>
                    <TableCell sx={{ fontWeight: "bold" }} align="right">
                      Stock
                    </TableCell>
                    <TableCell sx={{ fontWeight: "bold" }} align="center">
                      Estado
                    </TableCell>
                    <TableCell sx={{ fontWeight: "bold" }} align="center">
                      Etiqueta
                    </TableCell>

                    <TableCell sx={{ fontWeight: "bold" }} align="right">
                      Acciones
                    </TableCell>
                  </TableRow>
                </TableHead>

                <TableBody>
                  {especiales.map((p) => {
                    const index = especiales.findIndex(
                      (ep) => ep._id === p._id,
                    );

                    const base =
                      p.manualPreviousPrice && p.manualPreviousPrice > 0
                        ? p.manualPreviousPrice
                        : p.manualPrice && p.manualPrice > 0
                          ? p.manualPrice
                          : p.currentPrice || 0;

                    const finalPrice =
                      p.discount && p.discount > 0
                        ? Number((base * (1 - p.discount / 100)).toFixed(2))
                        : base;

                    const hasStock = p.stock > 0;

                    return (
                      <TableRow key={p._id} hover>
                        <TableCell align="center">
                          <Checkbox
                            checked={selectedEspeciales.has(p._id)}
                            onChange={() => toggleSelectEspecial(p._id)}
                          />
                        </TableCell>

                        {/* PRODUCTO */}
                        {/* <TableCell sx={{ maxWidth: 340 }}>
                          <Typography variant="body2" fontWeight="bold" noWrap>
                            {p.name}
                          </Typography>
                          <Typography variant="caption" sx={{ opacity: 0.7 }}>
                            {p.barcode}
                          </Typography>
                        </TableCell> */}
                        <TableCell sx={{ maxWidth: 340 }}>
                          <TextField
                            size="small"
                            value={p.manualName ?? p.name ?? ""}
                            onChange={(e) =>
                              updateEspecialField(
                                index,
                                "manualName",
                                e.target.value,
                              )
                            }
                            fullWidth
                            InputProps={{
                              sx: {
                                fontSize: 13,
                                fontWeight: 600,
                              },
                            }}
                          />

                          <Typography variant="caption" sx={{ opacity: 0.65 }}>
                            {p.barcode}
                          </Typography>
                        </TableCell>

                        {/* PRECIO */}
                        <TableCell align="right">
                          <TextField
                            size="small"
                            type="number"
                            value={p.manualPrice ?? p.currentPrice ?? ""}
                            onChange={(e) =>
                              updateEspecialField(
                                index,
                                "manualPrice",
                                Number(e.target.value),
                              )
                            }
                            sx={{ width: 110 }}
                          />
                        </TableCell>

                        {/* PRECIO ANTERIOR */}
                        <TableCell align="right">
                          <TextField
                            size="small"
                            type="number"
                            value={p.manualPreviousPrice ?? ""}
                            onChange={(e) =>
                              updateEspecialField(
                                index,
                                "manualPreviousPrice",
                                Number(e.target.value),
                              )
                            }
                            sx={{ width: 110 }}
                          />
                        </TableCell>

                        {/* DESCUENTO */}
                        <TableCell align="right">
                          <TextField
                            size="small"
                            type="number"
                            value={p.discount ?? 0}
                            onChange={(e) =>
                              updateEspecialField(
                                index,
                                "discount",
                                Number(e.target.value),
                              )
                            }
                            inputProps={{ min: 0, max: 100 }}
                            sx={{ width: 80 }}
                          />
                        </TableCell>

                        {/* PRECIO FINAL */}
                        <TableCell align="right">
                          <Typography fontWeight="bold">
                            ${finalPrice.toFixed(2)}
                          </Typography>
                        </TableCell>

                        {/* STOCK */}
                        <TableCell align="right">
                          <Typography>
                            {typeof p.stock === "number" ? p.stock : "-"}
                          </Typography>
                        </TableCell>

                        {/* ESTADO */}
                        <TableCell align="center">
                          {hasStock ? (
                            <Chip
                              label="Con stock"
                              size="small"
                              color="success"
                            />
                          ) : (
                            <Chip
                              label="Sin stock"
                              size="small"
                              color="warning"
                            />
                          )}
                        </TableCell>
                        <TableCell align="center">
                          <Select
                            size="small"
                            value={p.tipoEtiqueta || "oferta"}
                            onChange={(e) =>
                              updateEspecialField(
                                index,
                                "tipoEtiqueta",
                                e.target.value,
                              )
                            }
                            sx={{ width: 140 }}
                          >
                            <MenuItem value="oferta">Oferta</MenuItem>
                            <MenuItem value="liquidacion">Liquidaci√≥n</MenuItem>
                            <MenuItem value="nuevo">Nuevo</MenuItem>
                            <MenuItem value="promo">Promo</MenuItem>
                          </Select>
                        </TableCell>

                        {/* ACCIONES */}
                        <TableCell align="right">
                          <IconButton
                            color="error"
                            onClick={() => handleRemoveEspecial(index)}
                          >
                            <DeleteIcon />
                          </IconButton>
                        </TableCell>
                      </TableRow>
                    );
                  })}
                </TableBody>
              </Table>
            </Box>
          )}
        </Box>
      )}


 {tabIndex === 0 && (
        <Box>
          <ClasicasInput
            productos={clasicos}
            setProductos={setClasicos}
            generateBarcodeImage={generateBarcodeImage}
          />

          {/* üü¢ CL√ÅSICOS CON STOCK */}
          {clasicosConStock.length > 0 && (
            <>
              <Typography variant="subtitle1" sx={{ mt: 3 }}>
                Productos con stock:
              </Typography>
              <Button
                variant="contained"
                color="success"
                sx={{ mt: 1 }}
                onClick={() =>
                  generatePDF_Clasicas({ clasicos: clasicosConStock })
                }
              >
                Generar PDF (con stock)
              </Button>
            </>
          )}

          {/* üî¥ CL√ÅSICOS SIN STOCK */}
          {clasicosSinStock.length > 0 && (
            <>
              <Typography variant="subtitle1" sx={{ mt: 4 }}>
                Productos sin stock:
              </Typography>
              <Button
                variant="contained"
                color="warning"
                sx={{ mt: 1 }}
                onClick={() =>
                  generatePDF_Clasicas({ clasicos: clasicosSinStock })
                }
              >
                Generar PDF (sin stock)
              </Button>
            </>
          )}
        </Box>
      )}